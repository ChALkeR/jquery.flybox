(function(z){var J,Q,O,K,d,k,H,y,M,x,A=0,F={},i=[],e=0,E={},w=[],f=null,m=new Image(),n,L=1,h=0,r="",b,c,N=false,q=z.extend(z("<div/>")[0],{prop:0});var p=function(){Q.hide();m.onerror=m.onload=null;if(f){f.abort()}J.empty()};var v=function(){if(false===F.onError(i,A,F)){Q.hide();N=false;return}F.titleShow=false;F.width="auto";F.height="auto";J.html('<p id="flybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');l()};var u=function(){var V=i[A],S,U,W,T;p();F=z.extend({},z.fn.flybox.defaults,(typeof z(V).data("flybox")=="undefined"?F:z(V).data("flybox")));T=F.onStart(i,A,F);if(T===false){N=false;return}else{if(typeof T=="object"){F=z.extend(F,T)}}W=F.title||(V.nodeName?z(V).attr("title"):V.title)||"";if(V.nodeName&&!F.orig){F.orig=z(V).children("img:first").length?z(V).children("img:first"):z(V)}if(W===""&&F.orig&&F.titleFromAlt){W=F.orig.attr("alt")}S=F.href||(V.nodeName?z(V).attr("href"):V.href)||null;if((/^(?:javascript)/i).test(S)||S=="#"){S=null}if(F.type){U=F.type;if(!S){S=F.content}}else{if(F.content){U="html"}else{if(S){if(S.match(F.imageRegExp)){U="image"}else{if(z(V).hasClass("iframe")){U="iframe"}else{if(S.indexOf("#")===0){U="inline"}else{U="ajax"}}}}}}if(!U){v();return}if(U=="inline"){V=S.substr(S.indexOf("#"));U=z(V).length>0?"inline":"ajax"}F.type=U;F.href=S;F.title=W;if(F.autoDimensions){if(F.type=="html"||F.type=="inline"||F.type=="ajax"){F.width="auto";F.height="auto"}else{F.autoDimensions=false}}if(F.modal){F.overlayShow=true;F.hideOnOverlayClick=false;F.hideOnContentClick=false;F.enableEscapeButton=false;F.showCloseButton=false}F.padding=parseInt(F.padding,10);F.margin=parseInt(F.margin,10);J.css("padding",(F.padding+F.margin));z(".flybox-inline-tmp").unbind("flybox-cancel").bind("flybox-change",function(){z(this).replaceWith(k.children())});switch(U){case"html":J.html(F.content);l();break;case"inline":if(z(V).parent().is("#flybox-content")===true){N=false;return}z('<div class="flybox-inline-tmp" />').hide().insertBefore(z(V)).bind("flybox-cleanup",function(){z(this).replaceWith(k.children())}).bind("flybox-cancel",function(){z(this).replaceWith(J.children())});z(V).appendTo(J);l();break;case"image":N=false;z.flybox.showActivity();m=new Image();m.onerror=function(){v()};m.onload=function(){N=true;m.onerror=m.onload=null;D()};m.src=S;break;case"ajax":N=false;z.flybox.showActivity();F.ajax.win=F.ajax.success;f=z.ajax(z.extend({},F.ajax,{url:S,data:F.ajax.data||{},error:function(X,Z,Y){if(X.status>0){v()}},success:function(Y,aa,X){var Z=typeof X=="object"?X:f;if(Z.status==200){if(typeof F.ajax.win=="function"){T=F.ajax.win(S,Y,aa,X);if(T===false){Q.hide();return}else{if(typeof T=="string"||typeof T=="object"){Y=T}}}J.html(Y);l()}}}));break;case"iframe":C();break}};var l=function(){var S=F.width,T=F.height;if(S.toString().indexOf("%")>-1){S=parseInt((z(window).width()-(F.margin*2))*parseFloat(S)/100,10)+"px"}else{S=S=="auto"?"auto":S+"px"}if(T.toString().indexOf("%")>-1){T=parseInt((z(window).height()-(F.margin*2))*parseFloat(T)/100,10)+"px"}else{T=T=="auto"?"auto":T+"px"}J.wrapInner('<div style="width:'+S+";height:"+T+";overflow: "+(F.scrolling=="auto"?"auto":(F.scrolling=="yes"?"scroll":"hidden"))+';position:relative;"></div>');F.width=J.width();F.height=J.height();C()};var D=function(){F.width=m.width;F.height=m.height;z("<img />").attr({id:"flybox-img",src:m.src,alt:F.title}).appendTo(J);C()};var C=function(){Q.hide();if(K.is(":visible")&&false===E.onCleanup(w,e,E)){z.event.trigger("flybox-cancel");N=false;return}N=true;z(k.add(O)).unbind();z(window).unbind("resize.fb scroll.fb");z(document).unbind("keydown.fb");if(K.is(":visible")&&E.titlePosition!=="outside"){K.css("height",K.height())}w=i;e=A;E=F;if(E.overlayShow){O.css({"background-color":E.overlayColor,opacity:E.overlayOpacity,cursor:E.hideOnOverlayClick?"pointer":"auto",height:z(document).height()});if(!O.is(":visible")){O.show()}}else{O.hide()}c=P();j();if(K.is(":visible")){z(H.add(M).add(x)).hide();var T=K.position();b={top:T.top,left:T.left,width:K.width(),height:K.height()};var S=(b.width==c.width&&b.height==c.height);k.fadeTo(E.changeFade,0.3,function(){var U=function(){k.html(J.contents()).fadeTo(E.changeFade,1,t)};z.event.trigger("flybox-change");k.empty().css({"border-width":E.padding,width:c.width-E.padding*2,height:F.autoDimensions?"auto":c.height-h-E.padding*2});if(S){U()}else{q.prop=0;z(q).animate({prop:1},{duration:E.changeSpeed,easing:E.easingChange,step:R,complete:U})}});return}K.removeAttr("style");k.css("border-width",E.padding);if(E.transitionIn=="elastic"){b=G();k.html(J.contents());K.show();if(E.opacity){c.opacity=0}q.prop=0;z(q).animate({prop:1},{duration:E.speedIn,easing:E.easingIn,step:R,complete:t});return}if(E.titlePosition=="inside"&&h>0){y.show()}k.css({width:c.width-E.padding*2,height:F.autoDimensions?"auto":c.height-h-E.padding*2}).html(J.contents());K.css(c).fadeIn(E.transitionIn=="none"?0:E.speedIn,t)};var B=function(S){if(S&&S.length){return z('<div id="flybox-title-'+E.titlePosition+'"></div>').text(S)}return false};var j=function(){r=E.title||"";h=0;y.empty().removeAttr("style").removeClass();if(E.titleShow===false){y.hide();return}titleElement=z.isFunction(E.titleFormat)?E.titleFormat(r,w,e,E):B(r);if(!titleElement){y.hide();return}y.addClass("flybox-title-"+E.titlePosition).append(titleElement).appendTo("body").show();switch(E.titlePosition){case"inside":y.css({width:c.width-(E.padding*2),marginLeft:E.padding,marginRight:E.padding});h=y.outerHeight(true);y.appendTo(d);c.height+=h;break;case"over":y.css({marginLeft:E.padding,width:c.width-(E.padding*2),bottom:E.padding}).appendTo(d);break;case"float":y.css({left:parseInt((y.width()-c.width-40)/2,10)*-1}).appendTo(K);break;default:y.css({width:c.width-(E.padding*2),paddingLeft:E.padding,paddingRight:E.padding}).appendTo(K);break}y.hide()};var g=function(){if(E.enableEscapeButton||E.enableKeyboardNav){z(document).bind("keydown.fb",function(S){if(S.keyCode==27&&E.enableEscapeButton){S.preventDefault();z.flybox.close()}else{if((S.keyCode==37||S.keyCode==39)&&E.enableKeyboardNav&&S.target.tagName!=="INPUT"&&S.target.tagName!=="TEXTAREA"&&S.target.tagName!=="SELECT"){S.preventDefault();z.flybox[S.keyCode==37?"prev":"next"]()}}})}if(!E.showNavArrows){M.hide();x.hide();return}if((E.cyclic&&w.length>1)||e!==0){M.show()}if((E.cyclic&&w.length>1)||e!=(w.length-1)){x.show()}};var t=function(){if(F.autoDimensions){k.css("height","auto")}K.css("height","auto");if(r&&r.length){y.show()}if(E.showCloseButton){H.show()}g();if(E.hideOnContentClick){k.bind("click",z.flybox.close)}if(E.hideOnOverlayClick){O.bind("click",z.flybox.close)}z(window).bind("resize.fb",z.flybox.resize);if(E.centerOnScroll){z(window).bind("scroll.fb",z.flybox.center)}if(E.type=="iframe"){z('<iframe id="flybox-frame" name="flybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" scrolling="'+F.scrolling+'" src="'+E.href+'"></iframe>').appendTo(k)}K.show();N=false;z.flybox.center();E.onComplete(w,e,E);I()};var I=function(){var S,T;if((w.length-1)>e){S=w[e+1].href;if(typeof S!=="undefined"&&S.match(F.imageRegExp)){T=new Image();T.src=S}}if(e>0){S=w[e-1].href;if(typeof S!=="undefined"&&S.match(F.imageRegExp)){T=new Image();T.src=S}}};var R=function(T){var S={width:parseInt(b.width+(c.width-b.width)*T,10),height:parseInt(b.height+(c.height-b.height)*T,10),top:parseInt(b.top+(c.top-b.top)*T,10),left:parseInt(b.left+(c.left-b.left)*T,10)};if(typeof c.opacity!=="undefined"){S.opacity=T<0.5?0.5:T}K.css(S);k.css({width:S.width-E.padding*2,height:S.height-(h*T)-E.padding*2})};var s=function(){return[z(window).width()-(E.margin*2),z(window).height()-(E.margin*2),z(document).scrollLeft()+E.margin,z(document).scrollTop()+E.margin]};var P=function(){var S=s(),W={},T=E.autoScale,U=E.padding*2,V;if(E.width.toString().indexOf("%")>-1){W.width=parseInt((S[0]*parseFloat(E.width))/100,10)}else{W.width=E.width+U}if(E.height.toString().indexOf("%")>-1){W.height=parseInt((S[1]*parseFloat(E.height))/100,10)}else{W.height=E.height+U}if(T&&(W.width>S[0]||W.height>S[1])){if(F.type=="image"){V=(E.width)/(E.height);if((W.width)>S[0]){W.width=S[0];W.height=parseInt(((W.width-U)/V)+U,10)}if((W.height)>S[1]){W.height=S[1];W.width=parseInt(((W.height-U)*V)+U,10)}}else{W.width=Math.min(W.width,S[0]);W.height=Math.min(W.height,S[1])}}W.top=parseInt(Math.max(S[3]-20,S[3]+((S[1]-W.height-40)*0.5)),10);W.left=parseInt(Math.max(S[2]-20,S[2]+((S[0]-W.width-40)*0.5)),10);return W};var o=function(S){var T=S.offset();T.top+=parseInt(S.css("paddingTop"),10)||0;T.left+=parseInt(S.css("paddingLeft"),10)||0;T.top+=parseInt(S.css("border-top-width"),10)||0;T.left+=parseInt(S.css("border-left-width"),10)||0;T.width=S.width();T.height=S.height();return T};var G=function(){var U=F.orig?z(F.orig):false;if(U&&U.length){var T=o(U);return{width:T.width+(E.padding*2),height:T.height+(E.padding*2),top:T.top-E.padding-20,left:T.left-E.padding-20}}var S=s();return{width:E.padding*2,height:E.padding*2,top:parseInt(S[3]+S[1]*0.5,10),left:parseInt(S[2]+S[0]*0.5,10)}};var a=function(){if(!Q.is(":visible")){clearInterval(n);return}Q.css("background-position","0px -"+(L*40)+"px");L=(L+1)%12};z.fn.flybox=function(S){if(!z(this).length){return this}z(this).data("flybox",z.extend({},S,(z.metadata?z(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(U){U.preventDefault();if(N){return}N=true;z(this).blur();i=[];A=0;var T=z(this).attr("rel")||"";if(!T||T==""||T==="nofollow"){i.push(this)}else{i=z("a[rel="+T+"], area[rel="+T+"]");A=i.index(this)}u();return});return this};z.flybox=function(V){if(N){return}N=true;var U=typeof arguments[1]!=="undefined"?arguments[1]:{};i=[];A=parseInt(U.index,10)||0;if(z.isArray(V)){for(var T=0,S=V.length;T<S;T++){if(typeof V[T]=="object"){z(V[T]).data("flybox",z.extend({},U,V[T]))}else{V[T]=z({}).data("flybox",z.extend({content:V[T]},U))}}i=jQuery.merge(i,V)}else{if(typeof V=="object"){z(V).data("flybox",z.extend({},U,V))}else{V=z({}).data("flybox",z.extend({content:V},U))}i.push(V)}if(A>i.length||A<0){A=0}u()};z.flybox.showActivity=function(){clearInterval(n);Q.show();n=setInterval(a,66)};z.flybox.hideActivity=function(){Q.hide()};z.flybox.next=function(){return z.flybox.pos(e+1)};z.flybox.prev=function(){return z.flybox.pos(e-1)};z.flybox.pos=function(S){if(N){return}S=parseInt(S);i=w;if(S>-1&&S<w.length){A=S;u()}else{if(E.cyclic&&w.length>1){A=S>=w.length?0:w.length-1;u()}}return};z.flybox.cancel=function(){if(N){return}N=true;z.event.trigger("flybox-cancel");p();F.onCancel(i,A,F);N=false};z.flybox.close=function(){if(N||K.is(":hidden")){return}N=true;if(E&&false===E.onCleanup(w,e,E)){N=false;return}p();z(H.add(M).add(x)).hide();z(k.add(O)).unbind();z(window).unbind("resize.fb scroll.fb");z(document).unbind("keydown.fb");k.find("iframe").attr("src","about:blank");if(E.titlePosition!=="inside"){y.empty()}K.stop();function S(){O.fadeOut("fast");y.empty().hide();K.hide();z.event.trigger("flybox-cleanup");k.empty();E.onClosed(w,e,E);w=F=[];e=A=0;E=F={};N=false}if(E.transitionOut=="elastic"){b=G();var T=K.position();c={top:T.top,left:T.left,width:K.width(),height:K.height()};if(E.opacity){c.opacity=1}y.empty().hide();q.prop=1;z(q).animate({prop:0},{duration:E.speedOut,easing:E.easingOut,step:R,complete:S})}else{K.fadeOut(E.transitionOut=="none"?0:E.speedOut,S)}};z.flybox.resize=function(){if(O.is(":visible")){O.css("height",z(document).height())}z.flybox.center(true)};z.flybox.center=function(){if(N){return}var S=s();if((arguments[0]!==true)&&(K.width()>S[0]||K.height()>S[1])){return}K.stop().animate({top:parseInt(Math.max(S[3]-20,S[3]+((S[1]-k.height()-40)*0.5)-E.padding)),left:parseInt(Math.max(S[2]-20,S[2]+((S[0]-k.width()-40)*0.5)-E.padding))},typeof arguments[0]=="number"?arguments[0]:200)};z.flybox.init=function(){if(z("#flybox-wrap").length){return}z("body").append(J=z('<div id="flybox-tmp"></div>'),Q=z('<div id="flybox-loading"></div>').click(z.flybox.cancel),O=z('<div id="flybox-overlay"></div>'),K=z('<div id="flybox-wrap"></div>').append(d=z('<div id="flybox-outer"></div>').append(k=z('<div id="flybox-content"></div>'),H=z('<a id="flybox-close"></a>').click(z.flybox.close),y=z('<div id="flybox-title"></div>'),M=z('<div id="flybox-left"><span></span></div>').click(z.flybox.prev),x=z('<div id="flybox-right"><span></span></div>').click(z.flybox.next))));if(z.fn.mousewheel){K.bind("mousewheel.fb",function(S,T){if(N){S.preventDefault()}else{if(z(S.target).get(0).clientHeight==0||z(S.target).get(0).scrollHeight===z(S.target).get(0).clientHeight){S.preventDefault();z.flybox[T>0?"prev":"next"]()}}})}};z.fn.flybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,imageRegExp:/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};z(z.flybox.init)})(jQuery);