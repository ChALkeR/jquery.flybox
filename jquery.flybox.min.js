(function(A){var K,R,P,L,d,l,I,z,N,y,B=0,G={},j=[],e=0,F={},x=[],f=null,n=new Image(),i=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,o,M=1,h=0,s="",b,c,O=false,r=A.extend(A("<div/>")[0],{prop:0});var q=function(){R.hide();n.onerror=n.onload=null;if(f){f.abort()}K.empty()};var w=function(){if(false===G.onError(j,B,G)){R.hide();O=false;return}G.titleShow=false;G.width="auto";G.height="auto";K.html('<p id="flybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');m()};var v=function(){var W=j[B],T,V,X,U;q();G=A.extend({},A.fn.flybox.defaults,(typeof A(W).data("flybox")=="undefined"?G:A(W).data("flybox")));U=G.onStart(j,B,G);if(U===false){O=false;return}else{if(typeof U=="object"){G=A.extend(G,U)}}X=G.title||(W.nodeName?A(W).attr("title"):W.title)||"";if(W.nodeName&&!G.orig){G.orig=A(W).children("img:first").length?A(W).children("img:first"):A(W)}if(X===""&&G.orig&&G.titleFromAlt){X=G.orig.attr("alt")}T=G.href||(W.nodeName?A(W).attr("href"):W.href)||null;if((/^(?:javascript)/i).test(T)||T=="#"){T=null}if(G.type){V=G.type;if(!T){T=G.content}}else{if(G.content){V="html"}else{if(T){if(T.match(i)){V="image"}else{if(A(W).hasClass("iframe")){V="iframe"}else{if(T.indexOf("#")===0){V="inline"}else{V="ajax"}}}}}}if(!V){w();return}if(V=="inline"){W=T.substr(T.indexOf("#"));V=A(W).length>0?"inline":"ajax"}G.type=V;G.href=T;G.title=X;if(G.autoDimensions){if(G.type=="html"||G.type=="inline"||G.type=="ajax"){G.width="auto";G.height="auto"}else{G.autoDimensions=false}}if(G.modal){G.overlayShow=true;G.hideOnOverlayClick=false;G.hideOnContentClick=false;G.enableEscapeButton=false;G.showCloseButton=false}G.padding=parseInt(G.padding,10);G.margin=parseInt(G.margin,10);K.css("padding",(G.padding+G.margin));A(".flybox-inline-tmp").unbind("flybox-cancel").bind("flybox-change",function(){A(this).replaceWith(l.children())});switch(V){case"html":K.html(G.content);m();break;case"inline":if(A(W).parent().is("#flybox-content")===true){O=false;return}A('<div class="flybox-inline-tmp" />').hide().insertBefore(A(W)).bind("flybox-cleanup",function(){A(this).replaceWith(l.children())}).bind("flybox-cancel",function(){A(this).replaceWith(K.children())});A(W).appendTo(K);m();break;case"image":O=false;A.flybox.showActivity();n=new Image();n.onerror=function(){w()};n.onload=function(){O=true;n.onerror=n.onload=null;E()};n.src=T;break;case"ajax":O=false;A.flybox.showActivity();G.ajax.win=G.ajax.success;f=A.ajax(A.extend({},G.ajax,{url:T,data:G.ajax.data||{},error:function(Y,aa,Z){if(Y.status>0){w()}},success:function(Z,ab,Y){var aa=typeof Y=="object"?Y:f;if(aa.status==200){if(typeof G.ajax.win=="function"){U=G.ajax.win(T,Z,ab,Y);if(U===false){R.hide();return}else{if(typeof U=="string"||typeof U=="object"){Z=U}}}K.html(Z);m()}}}));break;case"iframe":D();break}};var m=function(){var T=G.width,U=G.height;if(T.toString().indexOf("%")>-1){T=parseInt((A(window).width()-(G.margin*2))*parseFloat(T)/100,10)+"px"}else{T=T=="auto"?"auto":T+"px"}if(U.toString().indexOf("%")>-1){U=parseInt((A(window).height()-(G.margin*2))*parseFloat(U)/100,10)+"px"}else{U=U=="auto"?"auto":U+"px"}K.wrapInner('<div style="width:'+T+";height:"+U+";overflow: "+(G.scrolling=="auto"?"auto":(G.scrolling=="yes"?"scroll":"hidden"))+';position:relative;"></div>');G.width=K.width();G.height=K.height();D()};var E=function(){G.width=n.width;G.height=n.height;A("<img />").attr({id:"flybox-img",src:n.src,alt:G.title}).appendTo(K);D()};var D=function(){R.hide();if(L.is(":visible")&&false===F.onCleanup(x,e,F)){A.event.trigger("flybox-cancel");O=false;return}O=true;A(l.add(P)).unbind();A(window).unbind("resize.fb scroll.fb");A(document).unbind("keydown.fb");if(L.is(":visible")&&F.titlePosition!=="outside"){L.css("height",L.height())}x=j;e=B;F=G;if(F.overlayShow){P.css({"background-color":F.overlayColor,opacity:F.overlayOpacity,cursor:F.hideOnOverlayClick?"pointer":"auto",height:A(document).height()});if(!P.is(":visible")){P.show()}}else{P.hide()}c=Q();k();if(L.is(":visible")){A(I.add(N).add(y)).hide();var U=L.position();b={top:U.top,left:U.left,width:L.width(),height:L.height()};var T=(b.width==c.width&&b.height==c.height);l.fadeTo(F.changeFade,0.3,function(){var V=function(){l.html(K.contents()).fadeTo(F.changeFade,1,u)};A.event.trigger("flybox-change");l.empty().css({"border-width":F.padding,width:c.width-F.padding*2,height:G.autoDimensions?"auto":c.height-h-F.padding*2});if(T){V()}else{r.prop=0;A(r).animate({prop:1},{duration:F.changeSpeed,easing:F.easingChange,step:S,complete:V})}});return}L.removeAttr("style");l.css("border-width",F.padding);if(F.transitionIn=="elastic"){b=H();l.html(K.contents());L.show();if(F.opacity){c.opacity=0}r.prop=0;A(r).animate({prop:1},{duration:F.speedIn,easing:F.easingIn,step:S,complete:u});return}if(F.titlePosition=="inside"&&h>0){z.show()}l.css({width:c.width-F.padding*2,height:G.autoDimensions?"auto":c.height-h-F.padding*2}).html(K.contents());L.css(c).fadeIn(F.transitionIn=="none"?0:F.speedIn,u)};var C=function(T){if(T&&T.length){return A('<div id="flybox-title-'+F.titlePosition+'"></div>').text(T)}return false};var k=function(){s=F.title||"";h=0;z.empty().removeAttr("style").removeClass();if(F.titleShow===false){z.hide();return}titleElement=A.isFunction(F.titleFormat)?F.titleFormat(s,x,e,F):C(s);if(!titleElement){z.hide();return}z.addClass("flybox-title-"+F.titlePosition).append(titleElement).appendTo("body").show();switch(F.titlePosition){case"inside":z.css({width:c.width-(F.padding*2),marginLeft:F.padding,marginRight:F.padding});h=z.outerHeight(true);z.appendTo(d);c.height+=h;break;case"over":z.css({marginLeft:F.padding,width:c.width-(F.padding*2),bottom:F.padding}).appendTo(d);break;case"float":z.css({left:parseInt((z.width()-c.width-40)/2,10)*-1}).appendTo(L);break;default:z.css({width:c.width-(F.padding*2),paddingLeft:F.padding,paddingRight:F.padding}).appendTo(L);break}z.hide()};var g=function(){if(F.enableEscapeButton||F.enableKeyboardNav){A(document).bind("keydown.fb",function(T){if(T.keyCode==27&&F.enableEscapeButton){T.preventDefault();A.flybox.close()}else{if((T.keyCode==37||T.keyCode==39)&&F.enableKeyboardNav&&T.target.tagName!=="INPUT"&&T.target.tagName!=="TEXTAREA"&&T.target.tagName!=="SELECT"){T.preventDefault();A.flybox[T.keyCode==37?"prev":"next"]()}}})}if(!F.showNavArrows){N.hide();y.hide();return}if((F.cyclic&&x.length>1)||e!==0){N.show()}if((F.cyclic&&x.length>1)||e!=(x.length-1)){y.show()}};var u=function(){if(G.autoDimensions){l.css("height","auto")}L.css("height","auto");if(s&&s.length){z.show()}if(F.showCloseButton){I.show()}g();if(F.hideOnContentClick){l.bind("click",A.flybox.close)}if(F.hideOnOverlayClick){P.bind("click",A.flybox.close)}A(window).bind("resize.fb",A.flybox.resize);if(F.centerOnScroll){A(window).bind("scroll.fb",A.flybox.center)}if(F.type=="iframe"){A('<iframe id="flybox-frame" name="flybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" scrolling="'+G.scrolling+'" src="'+F.href+'"></iframe>').appendTo(l)}L.show();O=false;A.flybox.center();F.onComplete(x,e,F);J()};var J=function(){var T,U;if((x.length-1)>e){T=x[e+1].href;if(typeof T!=="undefined"&&T.match(i)){U=new Image();U.src=T}}if(e>0){T=x[e-1].href;if(typeof T!=="undefined"&&T.match(i)){U=new Image();U.src=T}}};var S=function(U){var T={width:parseInt(b.width+(c.width-b.width)*U,10),height:parseInt(b.height+(c.height-b.height)*U,10),top:parseInt(b.top+(c.top-b.top)*U,10),left:parseInt(b.left+(c.left-b.left)*U,10)};if(typeof c.opacity!=="undefined"){T.opacity=U<0.5?0.5:U}L.css(T);l.css({width:T.width-F.padding*2,height:T.height-(h*U)-F.padding*2})};var t=function(){return[A(window).width()-(F.margin*2),A(window).height()-(F.margin*2),A(document).scrollLeft()+F.margin,A(document).scrollTop()+F.margin]};var Q=function(){var T=t(),X={},U=F.autoScale,V=F.padding*2,W;if(F.width.toString().indexOf("%")>-1){X.width=parseInt((T[0]*parseFloat(F.width))/100,10)}else{X.width=F.width+V}if(F.height.toString().indexOf("%")>-1){X.height=parseInt((T[1]*parseFloat(F.height))/100,10)}else{X.height=F.height+V}if(U&&(X.width>T[0]||X.height>T[1])){if(G.type=="image"){W=(F.width)/(F.height);if((X.width)>T[0]){X.width=T[0];X.height=parseInt(((X.width-V)/W)+V,10)}if((X.height)>T[1]){X.height=T[1];X.width=parseInt(((X.height-V)*W)+V,10)}}else{X.width=Math.min(X.width,T[0]);X.height=Math.min(X.height,T[1])}}X.top=parseInt(Math.max(T[3]-20,T[3]+((T[1]-X.height-40)*0.5)),10);X.left=parseInt(Math.max(T[2]-20,T[2]+((T[0]-X.width-40)*0.5)),10);return X};var p=function(T){var U=T.offset();U.top+=parseInt(T.css("paddingTop"),10)||0;U.left+=parseInt(T.css("paddingLeft"),10)||0;U.top+=parseInt(T.css("border-top-width"),10)||0;U.left+=parseInt(T.css("border-left-width"),10)||0;U.width=T.width();U.height=T.height();return U};var H=function(){var V=G.orig?A(G.orig):false;if(V&&V.length){var U=p(V);return{width:U.width+(F.padding*2),height:U.height+(F.padding*2),top:U.top-F.padding-20,left:U.left-F.padding-20}}var T=t();return{width:F.padding*2,height:F.padding*2,top:parseInt(T[3]+T[1]*0.5,10),left:parseInt(T[2]+T[0]*0.5,10)}};var a=function(){if(!R.is(":visible")){clearInterval(o);return}R.css("background-position","0px -"+(M*40)+"px");M=(M+1)%12};A.fn.flybox=function(T){if(!A(this).length){return this}A(this).data("flybox",A.extend({},T,(A.metadata?A(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(V){V.preventDefault();if(O){return}O=true;A(this).blur();j=[];B=0;var U=A(this).attr("rel")||"";if(!U||U==""||U==="nofollow"){j.push(this)}else{j=A("a[rel="+U+"], area[rel="+U+"]");B=j.index(this)}v();return});return this};A.flybox=function(W){if(O){return}O=true;var V=typeof arguments[1]!=="undefined"?arguments[1]:{};j=[];B=parseInt(V.index,10)||0;if(A.isArray(W)){for(var U=0,T=W.length;U<T;U++){if(typeof W[U]=="object"){A(W[U]).data("flybox",A.extend({},V,W[U]))}else{W[U]=A({}).data("flybox",A.extend({content:W[U]},V))}}j=jQuery.merge(j,W)}else{if(typeof W=="object"){A(W).data("flybox",A.extend({},V,W))}else{W=A({}).data("flybox",A.extend({content:W},V))}j.push(W)}if(B>j.length||B<0){B=0}v()};A.flybox.showActivity=function(){clearInterval(o);R.show();o=setInterval(a,66)};A.flybox.hideActivity=function(){R.hide()};A.flybox.next=function(){return A.flybox.pos(e+1)};A.flybox.prev=function(){return A.flybox.pos(e-1)};A.flybox.pos=function(T){if(O){return}T=parseInt(T);j=x;if(T>-1&&T<x.length){B=T;v()}else{if(F.cyclic&&x.length>1){B=T>=x.length?0:x.length-1;v()}}return};A.flybox.cancel=function(){if(O){return}O=true;A.event.trigger("flybox-cancel");q();G.onCancel(j,B,G);O=false};A.flybox.close=function(){if(O||L.is(":hidden")){return}O=true;if(F&&false===F.onCleanup(x,e,F)){O=false;return}q();A(I.add(N).add(y)).hide();A(l.add(P)).unbind();A(window).unbind("resize.fb scroll.fb");A(document).unbind("keydown.fb");l.find("iframe").attr("src","about:blank");if(F.titlePosition!=="inside"){z.empty()}L.stop();function T(){P.fadeOut("fast");z.empty().hide();L.hide();A.event.trigger("flybox-cleanup");l.empty();F.onClosed(x,e,F);x=G=[];e=B=0;F=G={};O=false}if(F.transitionOut=="elastic"){b=H();var U=L.position();c={top:U.top,left:U.left,width:L.width(),height:L.height()};if(F.opacity){c.opacity=1}z.empty().hide();r.prop=1;A(r).animate({prop:0},{duration:F.speedOut,easing:F.easingOut,step:S,complete:T})}else{L.fadeOut(F.transitionOut=="none"?0:F.speedOut,T)}};A.flybox.resize=function(){if(P.is(":visible")){P.css("height",A(document).height())}A.flybox.center(true)};A.flybox.center=function(){if(O){return}var T=t();if((arguments[0]!==true)&&(L.width()>T[0]||L.height()>T[1])){return}L.stop().animate({top:parseInt(Math.max(T[3]-20,T[3]+((T[1]-l.height()-40)*0.5)-F.padding)),left:parseInt(Math.max(T[2]-20,T[2]+((T[0]-l.width()-40)*0.5)-F.padding))},typeof arguments[0]=="number"?arguments[0]:200)};A.flybox.init=function(){if(A("#flybox-wrap").length){return}A("body").append(K=A('<div id="flybox-tmp"></div>'),R=A('<div id="flybox-loading"></div>').click(A.flybox.cancel),P=A('<div id="flybox-overlay"></div>'),L=A('<div id="flybox-wrap"></div>').append(d=A('<div id="flybox-outer"></div>').append(l=A('<div id="flybox-content"></div>'),I=A('<a id="flybox-close"></a>').click(A.flybox.close),z=A('<div id="flybox-title"></div>'),N=A('<div id="flybox-left"><span></span></div>').click(A.flybox.prev),y=A('<div id="flybox-right"><span></span></div>').click(A.flybox.next))));if(A.fn.mousewheel){L.bind("mousewheel.fb",function(T,U){if(O){T.preventDefault()}else{if(A(T.target).get(0).clientHeight==0||A(T.target).get(0).scrollHeight===A(T.target).get(0).clientHeight){T.preventDefault();A.flybox[U>0?"prev":"next"]()}}})}};A.fn.flybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};A(A.flybox.init)})(jQuery);